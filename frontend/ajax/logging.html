<!--Start Breadcrumb-->
<div class="row">
	<div id="breadcrumb" class="col-xs-12">
		<ol class="breadcrumb">
			<li><a href="index.html#ajax/logging.html">Logging</a></li>
		</ol>
	</div>
</div>
<!--End Breadcrumb-->

<!--Start Logging-->
<div class="panel panel-default">
    <div class="panel-heading">
        <i class="fa fa-file-text-o fa-fw"></i> Logging Panel
    </div>
    <!-- /.panel-heading -->
    <div class="panel-body">
        <ul class="nav nav-pills">
            <li class="active"><a href="#all-pills" data-toggle="tab">All</a>
            </li>
            <li class=""><a href="#info-pills" data-toggle="tab"><i class="fa fa-info fa-fw"></i> Info</a>
            </li>
            <li class=""><a href="#warning-pills" data-toggle="tab"><i class="fa fa-warning fa-fw"></i> Warning</a>
            </li>
            <li class=""><a href="#critical-pills" data-toggle="tab"><i class="fa fa-times-circle-o fa-fw"></i> Critical</a>
            </li>
        </ul>
        <div class="tab-content">
            <div id="all-pills" class="tab-pane fade active in"><div id="all" class="qa-message-list"></div></div>
            <div id="info-pills" class="tab-pane fade"><div id="info" class="qa-message-list"></div></div>
            <div id="warning-pills" class="tab-pane fade"><div id="warning" class="qa-message-list"></div></div>
            <div id="critical-pills" class="tab-pane fade"><div id="critical" class="qa-message-list"></div></div>
        </div>
        <!-- /.list-group -->
        <button type="button" class="btn btn-primary btn-label-left"><span><i class="fa fa-history"></i></span>Clear</button>
        <button type="button" class="btn btn-primary btn-label-left"><span><i class="fa fa-cloud-download"></i></span>Download</button>
    </div>
    <!-- /.panel-body -->

</div>
<!-- /.panel -->


<!--End Logging -->
<div style="height: 40px;"></div>

<script type="text/javascript">
    //IP de la database
    var databaseIP = "37.187.9.5:13370";
    var naviID = "1";

    $(document).ready(function() {
        $.ajax({
            url: "http://" + databaseIP + "/log/getlogs/" + naviID,
            dataType: "json",
            success: function(log_data){
                // Recorrer totes les entrades de log rebudes
                $.each(log_data, function(index, log){
                    var localDateTime = (new Date((log['timestamp'] * 1000)).toLocaleString());

                    var entry =
                        '<div class="message-item">' +
                            '<div class="message-inner">' +
                                '<div class="message-head clearfix">' +
                                    '<div class="avatar pull-left"><img class="logging" src="./img/' + log['levelno'] + '.png"></div>' +
                                    '<div class="user-detail">' +
                                        '<h5 class="handle">' + log['message'] + '</h5>' +
                                        '<div class="post-meta">' +
                                            '<div class="asker-meta">' +
                                            '<span class="qa-message-what"></span>' +
                                            '<span class="text-muted">' +
                                                '<em>' + localDateTime + '</em>' +
                                            '</span>' +
                                        '</div>' +
                                    '</div>' +
                                    '</div>' +
                                '</div>' +
                            '</div>' +
                        '</div>';

                    /*var entry = '<a href="#" class="list-group-item">' + log['message'] +
                        '<span class="pull-right text-muted small">' +
                        '<em>' + localDateTime + '</em></span></a>';
                    */
                    // Afegir entrada de log en el tab corresponent al loglevel
                    switch (log['levelno']) {
                        /*case 1:
                            $("#debug").prepend(entry);
                            break;
                        */
                        case 20:
                            $("#info").prepend(entry);
                            break;
                        case 30:
                            $("#warning").prepend(entry);
                            break;
                        /*case 40:
                            $("#error").prepend(entry);
                            break;
                        */
                        case 50:
                            $("#critical").prepend(entry);
                            break;
                    }
                    $("#all").prepend(entry);
                });
            },
            error: function (e) {
                alert('Database Connection Logging Error.');
            }
        });


        // Filtre per al input search
        $("#input-search").on("keyup", function() {
            var rex = new RegExp($(this).val(), 'i');
            console.log(rex);
            $(".qa-message-list").find(".message-item").hide();
            $(".qa-message-list").find(".message-item").filter(function() {
                return rex.test($(this).text());
            }).show();
        });


    var timestamp = $.now();
/*
    (function poll(){
            setTimeout(function() {
                if (location.hash.replace(/^#/, '') == 'ajax/logging.html'){
                    $.ajax({
                        url: "http://localhost:8080/getLog/" + timestamp,
                        dataType: "json",
                        success: function(data){
                            var resp = jQuery.parseJSON(data);
                            console.log("Success: " + resp.success);
                            //console.log("Payload: " + resp.payload['logs'][0]['timestamp']);
                        },
                        complete: poll
                    });
               }
            }, 5000);
    })();*/
});
</script>